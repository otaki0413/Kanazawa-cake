<div class="container">
  <div class="row">
  <!--エラーメッセージ-->
  <% if @cart_item.errors.any? %>
  <h3><%= @cart_item.errors.count %>個のエラーがあります。</h3>
    <% @cart_item.errors.full_messages.each do |message| %>
    <ul>
      <li><%= message %></li>
    </ul>
    <% end %>
  <% end %>

    <div class="box col-12">
      <div class="col-sm-4 bg-warning">
        <h3 class="table-title">ショッピングカート</h3>
      </div>
      <!--ここからカートテーブル-->
      <table class="table table-hover table-bordered">
        <thead>
          <tr>
            <th>商品名</th>
            <th>単価（税込）</th>
            <th>数量</th>
            <th>小計</th>
            <th>削除ボタン</th>
          </tr>
        </thead>

        <% @cart_items.each do |cart| %>
        <tbody>
          <tr>
            <td>
              <%= attachment_image_tag cart.product, :image, format: 'jpeg', fallback: "no_image.jpg", size: "40x40" %>
              <%= cart.product.name %>
            </td>
            <!--税抜き価格-->
            <td><%= cart.tax_included_price.to_s(:delimited) %>円</td>
            <td>
              <!--商品の個数を変更するフォーム-->
              <%= form_with model: cart, url: cart_item_path(cart.id), method: :patch, local: true do |f| %>
                <%= f.number_field :amount %>
                <%= f.hidden_field :product_id, value: cart.product.id %>
                <%= f.submit '変更', class: "btn btn-primary" %>
              <% end %>
            </td>
            <!--小計-->
            <td><%= cart.subtotal.to_s(:delimited) %>円</td>
            <td>
              <%= link_to '削除する', cart_item_path(cart.id), class: "btn btn-danger", method: :delete, "data-confirm" => "Are you sure?" %>
            </td>
          </tr>
        </tbody>
        <% end %>
      </table>

      <!--CSSで合計金額の表を作る-->
      <table class="bg-warning">
        <tr>
          <th>合計金額</th>
          <td><%= @total_price.to_s(:delimited) %></td>
        </tr>
      </table>

      <div class="btn-all-destroy">
        <%= link_to 'カートを空にする', cart_items_path, class: "btn btn-danger", method: :delete, "data-confirm" => "本当に削除しますか?" %>
      </div>

      <div class="btn-large">
        <%= link_to '買い物を続ける', products_path, class: "btn btn-primary btn-lg" %>
        <%= link_to '情報入力に進む', new_order_path, class: "btn btn-success btn-lg" %>
      </div>

    </div>
  </div>
</div>
